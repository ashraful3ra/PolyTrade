{% extends "base.html" %}{% set active_page='dashboard' %}
{% block head %}
<link href="https://cdn.jsdelivr.net/npm/tom-select@2.4.3/dist/css/tom-select.css" rel="stylesheet">
{% endblock %}
{% block content %}
<div class="grid">
  <div class="card">
    <h2>Setup Trade</h2>
    <div id="trade-setup-error" class="alert-danger" style="display:none; margin-bottom: 15px;"></div>
    <div class="row">
      <div style="flex:1"><label class="small">Bot Name</label><input id="bot_name" class="input" placeholder="e.g., My ETH Scalp"></div>
      <div style="flex:1"><label class="small">Trade Account</label>
        <select id="bot_account" class="input">
          <option value="">Select account</option>
          {% for a in accounts %}{% if a.active %}<option value="{{a.id}}">{{a.name}} ({{'Testnet' if a.testnet else 'Mainnet'}})</option>{% endif %}{% endfor %}
        </select>
      </div>
    </div>
    <div class="mt2">
        <label class="small">Coin (USDT-M Futures)</label>
        <select id="coin_search_input" placeholder="Type to search coin..." multiple></select>
    </div>
    <div class="row mt2">
      <div style="flex:1"><label class="small">Side</label><select id="trade_side" class="input"><option value="LONG">Long</option><option value="SHORT">Short</option></select></div>
      <div style="flex:1"><label class="small">Margin Mode</label><select id="margin_mode" class="input"><option value="ISOLATED">Isolated</option><option value="CROSSED">Cross</option></select></div>
    </div>

    <div class="mt2">
        <h3 class="collapsible active">
            Symbol Settings
        </h3>
        <div class="content" style="display: block;">
            <div id="coin_settings_container" class="mt">
                <p class="small" style="text-align: center;">No coins selected yet.</p>
            </div>
            <div class="row mt" style="justify-content: space-between; border-top: 1px solid #1e2a3f; padding-top: 12px; margin-top: 15px;">
                <span class="small">Total Estimated Cost: <b id="total_est_cost">0.00 USDT</b></span>
                <span class="small">Total Coin select: <b id="coin_count_display">0</b></span>
            </div>
        </div>
    </div>
    
    <div class="row mt2" style="gap: 12px; justify-content: flex-end;">
      <button id="btn_submit_trade" class="btn btn-success" style="flex:1;">Submit Trade</button>
      <button id="btn_save_template" class="btn btn-primary" style="flex:1;">Save Template</button>
    </div>

    <div class="mt2"><h3>Saved Templates</h3><div id="tpl_list" class="list"></div></div>
  </div>

  <div class="card">
    <div class="row" style="justify-content:space-between; align-items: center; flex-wrap: wrap; gap: 10px;">
      <h2>Running Trade <span id="ws_status" class="status-warn" style="font-size: 12px; vertical-align: middle;">Offline</span></h2>
      <div class="row" style="flex-grow: 1; justify-content: space-between;">
        <div style="position:relative; max-width: 200px;"><input id="roi_search_input" class="input input-small" type="number" placeholder="ROI â‰¥ %"><span id="roi_match_count" class="badge" style="position:absolute; right: 10px; top: 7px; background: var(--primary); color: #000;">0</span></div>
        <div class="row" style="gap: 10px;">
            <button id="btn_close_selected" class="btn btn-warning btn-small">Close Selected</button>
            <button id="btn_close_all" class="btn btn-danger btn-small">Close All</button>
        </div>
      </div>
    </div>
    <div id="running-trade-error" class="alert-danger" style="display:none; margin-top: 15px;"></div>
    <div id="running_trades_container" class="mt2" style="max-height: 600px; overflow-y: auto;"><p class="small" style="text-align: center;">Select an account to view running trades.</p></div>
  </div>
</div>
{% endblock %}
{% block scripts %}
<script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/tom-select@2.4.3/dist/js/tom-select.complete.min.js"></script>
<script src="{{ url_for('static', filename='js/dashboard.js') }}"></script>
<script>
    document.addEventListener('DOMContentLoaded', () => {
        initDashboard();
    });
</script>
{% endblock %}